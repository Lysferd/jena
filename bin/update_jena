#!/usr/bin/env ruby
$:.push File.expand_path("../lib", __FILE__)
require 'rubygems'
require 'fileutils'
require 'open-uri'
load 'lib/jruby_jena/version.rb'

LATEST_JENA="http://sourceforge.net/projects/jena/files/Jena/Jena-#{Jena::VERSION}/jena-#{Jena::VERSION}.zip/download"
OUTPUT="downloads/jena-#{Jena::VERSION}.zip"

FileUtils.mkdir_p "downloads"

unless File.exist? OUTPUT
  puts "Downloading Jena #{Jena::VERSION}..."
  open( LATEST_JENA ) do |url|
    File.open( OUTPUT,"wb" ) do |file|
      file.puts url.read
    end
  end
end

`unzip -jo #{OUTPUT} **/lib/*.jar -x '**/lib/junit*.jar' '**/lib/*tests.jar' -d javalib`

puts "Writing lib/jruby_jena/jars.rb ..."
r = File.open( 'lib/jruby_jena/jars.rb', 'w' )
r << "module Jena\n"
Dir.glob( 'javalib/*.jar' ).each do |f|
  r << "  require '#{f}'\n"
end
r << "end\n"
r.close
